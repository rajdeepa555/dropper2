import math

class CProxy(object):
	
	def __init__(self,no_of_threads,group_index):
		self.proxy_list = []
		self.current_proxy = None
		self.no_of_threads = no_of_threads
		self.group_index = group_index
		self._prepare_proxy_list()

	def _get_offset(self):
		proxy_start_index = 0
		proxy_end_index = 0
		proxy_in_a_group = int(math.floor(float(len(self.proxy_list))/float(self.no_of_threads)))
		proxy_start_index = self.group_index*proxy_in_a_group
		if self.no_of_threads == (self.group_index+1):
			proxy_end_index = len(self.proxy_list)
		else:
			proxy_end_index = proxy_start_index+(proxy_in_a_group)
		return proxy_start_index,proxy_end_index


	def _add_https_prefix(self,proxy):
		return "https://"+proxy

	def _prepare_proxy_list(self):
		# proxy_list = ["192.126.202.127:3128","192.126.202.188:3128","179.43.130.100:3128","192.126.204.59:3128","166.88.124.240:3128","45.33.157.60:3128","179.43.129.249:3128","45.33.145.194:3128","166.88.120.174:3128","192.126.202.7:3128","45.33.157.129:3128","166.88.120.31:3128","192.126.204.252:3128","166.88.120.87:3128","166.88.124.123:3128","45.33.145.185:3128","45.33.145.190:3128","166.88.120.27:3128","179.43.129.109:3128","192.126.202.172:3128","192.126.204.148:3128","45.33.145.108:3128","45.33.157.188:3128","45.33.157.195:3128","45.33.157.240:3128","45.33.145.29:3128","192.126.204.25:3128","179.43.130.159:3128","179.43.130.50:3128","192.126.202.218:3128","166.88.124.6:3128","166.88.120.149:3128","179.43.130.118:3128","179.43.130.70:3128","179.43.129.89:3128","166.88.124.224:3128","192.126.202.95:3128","179.43.130.123:3128","179.43.129.78:3128","45.33.157.78:3128","192.126.204.254:3128","179.43.129.19:3128","192.126.204.154:3128","179.43.130.127:3128","166.88.120.100:3128","179.43.129.211:3128","45.33.145.178:3128","166.88.124.35:3128","179.43.130.150:3128"]
		# proxy_list = ["170.130.58.123:3128","173.232.7.49:3128","104.140.164.94:3128","104.140.164.91:3128","89.32.71.12:3128","192.161.166.158:3128","173.232.7.46:3128","170.130.58.140:3128","173.232.7.169:3128","89.32.71.185:3128","50.2.15.35:3128","192.161.166.180:3128","170.130.58.158:3128","89.32.71.118:3128","89.32.71.35:3128","192.161.166.109:3128","192.161.166.12:3128","104.140.164.248:3128","50.2.15.187:3128","170.130.58.152:3128","50.2.15.95:3128","170.130.58.40:3128","50.2.15.188:3128","104.140.164.158:3128","173.232.7.61:3128"]
		# proxy_list = ["104.140.4.204:3128","23.19.32.92:3128","23.19.32.11:3128","173.234.226.71:3128","192.161.166.87:3128","50.31.9.1:3128","104.140.4.115:3128","192.161.166.48:3128","173.208.36.154:3128","173.234.226.198:3128","173.208.36.19:3128","50.31.9.59:3128","192.126.153.64:3128","104.140.4.100:3128","173.234.226.45:3128","23.254.78.150:3128","192.161.166.11:3128","173.208.36.141:3128","173.208.36.179:3128","104.140.4.169:3128","23.254.78.33:3128","192.161.166.168:3128","23.19.32.148:3128","173.234.226.239:3128","192.126.153.176:3128","23.19.32.178:3128","173.208.36.231:3128","50.31.9.231:3128","173.234.226.110:3128","173.234.226.53:3128","173.234.226.73:3128","192.126.153.77:3128","50.31.9.20:3128","23.19.32.60:3128","192.126.153.55:3128","173.208.36.143:3128","192.161.166.44:3128","23.254.78.68:3128","104.140.4.242:3128","50.31.9.129:3128","192.161.166.154:3128","173.234.226.139:3128","192.126.153.33:3128","23.254.78.57:3128","23.19.32.159:3128","104.140.4.215:3128","50.31.9.34:3128","23.254.78.176:3128","192.126.153.254:3128","23.254.78.35:3128"]
		proxy_list = ["173.232.119.209:3128","196.16.83.163:3128","196.16.83.208:3128","196.17.155.1:3128","196.16.83.117:3128","173.232.119.170:3128","213.184.121.12:3128","196.19.254.251:3128","172.245.169.26:3128","173.232.119.160:3128","196.18.132.250:3128","196.18.132.135:3128","172.245.169.236:3128","196.19.254.51:3128","173.232.119.15:3128","172.245.169.186:3128","45.72.87.84:3128","196.17.155.37:3128","196.17.155.91:3128","196.17.155.213:3128","196.18.132.190:3128","196.18.132.146:3128","196.19.254.230:3128","45.72.87.112:3128","196.19.254.110:3128","45.72.87.24:3128","196.16.83.203:3128","213.184.121.78:3128","196.17.155.75:3128","172.245.169.121:3128","213.184.121.17:3128","172.245.169.49:3128","196.17.155.82:3128","196.18.132.160:3128","196.17.155.119:3128","45.72.87.30:3128","213.184.121.139:3128","173.232.119.221:3128","172.245.169.18:3128","173.232.119.222:3128","196.18.132.3:3128","213.184.121.90:3128","196.19.254.218:3128","45.72.87.3:3128","213.184.121.123:3128","196.16.83.99:3128","196.17.155.188:3128","196.16.83.236:3128","45.72.87.71:3128","196.19.254.85:3128"]
		if proxy_list is not None and len(proxy_list)>0:
			all_proxies = []
			for proxy in proxy_list: 
				all_proxies.append(self._add_https_prefix(proxy))
			self.proxy_list = all_proxies
			start_index, end_index = self._get_offset()
			self.proxy_list = all_proxies[start_index:end_index+1]


	def _get_next_proxy_index(self):
		next_proxy_index = 0
		if self.current_proxy is not None:
			current_proxy_index = self.proxy_list.index(self.current_proxy)
			next_proxy_index =   (current_proxy_index+1) % len(self.proxy_list)
		return next_proxy_index

	def get_proxy(self):
		if self.proxy_list is not None and len(self.proxy_list)>0:
			self.current_proxy = self.proxy_list[self._get_next_proxy_index()]
		return self.current_proxy

	